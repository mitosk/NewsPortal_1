{% extends 'base.html' %}

{% block title %}–ü–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π{% endblock %}

{% block content %}
<div class="mb-4">
    <h1 class="text-center">üîç –ü–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π</h1>
</div>

<nav class="mb-3">
    <a href="{% url 'news_list' %}" class="btn btn-outline-primary btn-sm">–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏</a>
    <a href="{% url 'article_search' %}" class="btn btn-outline-success btn-sm">–ü–æ–∏—Å–∫ —Å—Ç–∞—Ç–µ–π</a>
    {% if user.is_authenticated %}
        <a href="{% url 'news_create' %}" class="btn btn-success btn-sm">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å</a>
    {% endif %}
</nav>

<div class="card p-3 mb-4 bg-light">
    <h5>–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞:</h5>
    <form method="get" class="row g-3">
        {{ filterset.form.as_p }}
        <div class="col-12">
            <button type="submit" class="btn btn-primary">–ù–∞–π—Ç–∏</button>
            <a href="{% url 'news_search' %}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
        </div>
    </form>
</div>

{% for item in news %}
<div class="post p-3 mb-3 border rounded bg-white">
    <h2>{{ item.title }}</h2>
    <p>{{ item.text|truncatewords:50 }}</p>

    <p class="post-meta">
        –ê–≤—Ç–æ—Ä: {{ item.author.user.username }} | –î–∞—Ç–∞: {{ item.created_at|date:"d.m.Y H:i" }} | –†–µ–π—Ç–∏–Ω–≥: {{ item.rating }}
    </p>

    <p>
        <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:</strong>
        {% for cat in item.categories.all %}
            <span class="badge bg-secondary">{{ cat.name }}</span>
        {% empty %}
            <span class="text-muted">–±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
        {% endfor %}
    </p>

    {% if user.is_authenticated and user == item.author.user or user.is_superuser %}
        <a href="{% url 'news_edit' item.pk %}" class="btn btn-warning btn-sm">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        <a href="{% url 'news_delete' item.pk %}" class="btn btn-danger btn-sm">–£–¥–∞–ª–∏—Ç—å</a>
    {% endif %}
</div>
{% empty %}
<div class="empty-state text-center p-5 text-muted">
    <h3>–ù–æ–≤–æ—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞.</p>
</div>
{% endfor %}

{% if is_paginated %}
<div class="pagination mt-4 text-center">
    {% if page_obj.has_previous %}
        <a href="?page=1{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="btn btn-outline-primary btn-sm">&laquo; –ø–µ—Ä–≤–∞—è</a>
        <a href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="btn btn-outline-primary btn-sm">–ø—Ä–µ–¥—ã–¥—É—â–∞—è</a>
    {% endif %}

    <span class="btn btn-primary btn-sm disabled">
        –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
    </span>

    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="btn btn-outline-primary btn-sm">—Å–ª–µ–¥—É—é—â–∞—è</a>
        <a href="?page={{ page_obj.paginator.num_pages }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="btn btn-outline-primary btn-sm">–ø–æ—Å–ª–µ–¥–Ω—è—è &raquo;</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
